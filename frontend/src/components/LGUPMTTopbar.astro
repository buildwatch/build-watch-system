---
// LGU-PMT Topbar Component
// Theme Color: #FE5353
---

<header class="relative z-50 flex items-center justify-between px-8 py-4 bg-gradient-to-r from-[#3B82F6] via-[#2563EB] to-[#1D4ED8] text-white shadow-lg border-b border-white/10 backdrop-blur-sm">
  <div class="pointer-events-none absolute inset-0 bg-gradient-to-r from-white/5 via-transparent to-white/5 opacity-10"></div>
  <div class="flex items-center justify-between relative w-full">
    <!-- Left Section -->
    <div class="flex items-center space-x-6">
      <!-- Sidebar Toggle Button -->
      <button id="lgu-pmt-sidebar-toggle" class="group p-2.5 rounded-xl bg-white/10 hover:bg-white/20 active:scale-95 transition-all duration-300 backdrop-blur-sm border border-white/20 shadow-lg hover:shadow-xl">
        <svg id="lgu-pmt-sidebar-toggle-icon" class="w-6 h-6 text-white transition-all duration-300 group-hover:scale-110" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
        </svg>
      </button>

      <!-- Logo and Title Section -->
      <div class="flex items-center gap-4">
        <div class="w-10 h-10 rounded-lg overflow-hidden bg-white/10 backdrop-blur-sm shadow-lg border border-white/20 flex items-center justify-center">
          <img src="/build-watch-logo.png" alt="Build Watch Logo" class="w-full h-full object-contain" />
        </div>
        <div>
          <h1 class="text-xl font-bold text-white drop-shadow-sm">Build Watch</h1>
          <p class="text-xs text-gray-400">MPMEC</p>
        </div>
      </div>
    </div>

    <!-- Middle Section -->
    <div class="flex items-center gap-6">
      <!-- Search Bar -->
      <div class="relative">
        <input 
          type="text" 
          id="lgu-pmt-global-search"
          placeholder="Search projects, reports, notices..." 
          class="w-80 pl-10 pr-4 py-2.5 bg-white/10 border border-white/20 rounded-xl text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-white/30 focus:border-transparent backdrop-blur-sm transition-all duration-300"
        />
        <svg class="absolute left-3 top-3 w-5 h-5 text-white/60" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
        </svg>
      </div>

      <!-- Date and Time -->
      <div class="text-center">
        <p id="lgu-pmt-current-date" class="text-sm font-medium text-white">Loading...</p>
        <p class="text-xs text-blue-200/80">Philippine Standard Time</p>
      </div>

      <!-- System Status -->
      <div class="flex items-center gap-2 px-3 py-2 bg-green-500/20 rounded-lg border border-green-400/30">
        <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
        <span class="text-sm font-medium text-green-300">System Operational</span>
      </div>
    </div>

    <!-- Right Section -->
    <div class="flex items-center gap-4">
      <!-- System Management Actions -->
      <div class="flex items-center gap-2">
        <!-- System Announcement Button -->
        <a href="/dashboard/lgu-pmt-mpmec/modules/announcements" title="System Announcements" aria-label="System Announcements" class="group relative p-2.5 text-white hover:text-white/80 hover:bg-gradient-to-r hover:from-white/20 hover:to-gray-300/20 rounded-xl transition-all duration-300 ease-out focus:outline-none focus:ring-2 focus:ring-white/30 hover:scale-110 hover:shadow-lg hover:shadow-white/25 transform-gpu">
          <svg class="w-5 h-5 transition-all duration-300 group-hover:scale-110 group-hover:rotate-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.832c4.1 0 7.625-1.234 9.168-3v14c-1.543-1.766-5.067-3-9.168-3H7a3.988 3.988 0 01-1.564-.317z"></path>
          </svg>
          <!-- Enhanced hover glow effect -->
          <div class="absolute inset-0 bg-gradient-to-r from-white/0 via-white/20 to-gray-300/0 rounded-xl opacity-0 group-hover:opacity-100 transition-opacity duration-300 blur-sm"></div>
        </a>
        
        <!-- Send Feedback to Secretariat Button -->
        <a href="/dashboard/lgu-pmt-mpmec/modules/send-feedback" title="Send Feedback to Secretariat" aria-label="Send Feedback to Secretariat" class="group relative p-2.5 text-white hover:text-white/80 hover:bg-gradient-to-r hover:from-white/20 hover:to-gray-300/20 rounded-xl transition-all duration-300 ease-out focus:outline-none focus:ring-2 focus:ring-white/30 hover:scale-110 hover:shadow-lg hover:shadow-white/25 transform-gpu">
          <svg class="w-5 h-5 transition-all duration-300 group-hover:scale-110 group-hover:rotate-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
          </svg>
          <!-- Enhanced hover glow effect -->
          <div class="absolute inset-0 bg-gradient-to-r from-white/0 via-white/20 to-gray-300/0 rounded-xl opacity-0 group-hover:opacity-100 transition-opacity duration-300 blur-sm"></div>
        </a>
        
        <!-- System Health Button -->
        <a href="/dashboard/lgu-pmt-mpmec/modules/system-health" title="System Health" aria-label="System Health" class="group relative p-2.5 text-white hover:text-white/80 hover:bg-gradient-to-r hover:from-white/20 hover:to-gray-300/20 rounded-xl transition-all duration-300 ease-out focus:outline-none focus:ring-2 focus:ring-white/30 hover:scale-110 hover:shadow-lg hover:shadow-white/25 transform-gpu">
          <svg class="w-5 h-5 transition-all duration-300 group-hover:scale-110 group-hover:rotate-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
          </svg>
          <!-- Enhanced hover glow effect -->
          <div class="absolute inset-0 bg-gradient-to-r from-white/0 via-white/20 to-gray-300/0 rounded-xl opacity-0 group-hover:opacity-100 transition-opacity duration-300 blur-sm"></div>
        </a>
      </div>

      <!-- Notifications -->
      <button class="group relative p-2.5 text-white hover:text-white/80 hover:bg-gradient-to-r hover:from-white/20 hover:to-gray-300/20 rounded-xl transition-all duration-300 ease-out focus:outline-none focus:ring-2 focus:ring-white/30 hover:scale-110 hover:shadow-lg hover:shadow-white/25 transform-gpu" id="lgu-pmt-notification-btn">
        <svg class="w-5 h-5 transition-all duration-300 group-hover:scale-110 group-hover:rotate-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5 5v-5z"></path>
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
        </svg>
        <!-- Enhanced hover glow effect -->
        <div class="absolute inset-0 bg-gradient-to-r from-white/0 via-white/20 to-gray-300/0 rounded-xl opacity-0 group-hover:opacity-100 transition-opacity duration-300 blur-sm"></div>
        <span class="absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center hidden animate-pulse group-hover:scale-110 transition-transform duration-200" id="lgu-pmt-notification-badge">0</span>
      </button>

            <!-- User Profile with Enhanced Dropdown -->
      <div class="relative" id="lgu-pmt-profile-container">
        <button id="lgu-pmt-user-dropdown-btn" class="flex items-center gap-3 p-2 rounded-xl hover:bg-white/10 transition-all duration-300" title="Open profile menu" aria-haspopup="true" aria-expanded="false">
          <div class="w-10 h-10 rounded-xl overflow-hidden ring-2 ring-white/20 shadow-lg">
            <img 
              id="lgu-pmt-topbar-profile-picture"
              src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' fill='%233B82F6'/%3E%3Ctext x='50' y='50' font-family='Arial' font-size='40' font-weight='bold' text-anchor='middle' dy='.3em' fill='white'%3EMP%3C/text%3E%3C/svg%3E"
              alt="User Profile"
              class="w-full h-full object-cover transition-transform duration-300 hover:scale-110"
              onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
            />
            <div class="w-full h-full bg-gradient-to-br from-blue-600 to-blue-700 flex items-center justify-center" style="display: none;">
              <span class="text-white font-bold text-sm">MP</span>
            </div>
          </div>
          <div class="text-left hidden md:block max-w-[200px]">
            <p id="lgu-pmt-user-name" class="text-sm font-semibold text-white truncate" title="Loading...">Loading...</p>
            <div class="flex items-center gap-1">
              <p id="lgu-pmt-user-role" class="text-xs text-blue-200/80">LGU-PMT</p>
              <div class="flex items-center gap-1">
                <div class="w-1.5 h-1.5 bg-green-400 rounded-full animate-pulse"></div>
                <span class="text-xs text-green-300 font-medium">Active</span>
              </div>
            </div>
          </div>
          <svg class="w-4 h-4 text-white/60" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
          </svg>
        </button>

        <!-- Enhanced MPMEC Dropdown Menu -->
        <div id="lgu-pmt-profile-dropdown" class="absolute right-0 mt-3 w-64 bg-gradient-to-br from-blue-900 via-blue-800 to-blue-900 rounded-2xl shadow-2xl border border-blue-700/30 opacity-0 invisible scale-95 transform transition-all duration-500 ease-out z-50 backdrop-blur-xl hidden">
          <!-- Header Section -->
          <div class="p-4 border-b border-blue-600/30" style="background: linear-gradient(135deg, rgba(30, 58, 138, 0.15) 0%, rgba(37, 99, 235, 0.1) 100%);">
            <div class="flex items-center space-x-3">
              <div class="w-12 h-12 rounded-xl overflow-hidden ring-2 ring-blue-400/40 shadow-lg">
                <img 
                  id="lgu-pmt-dropdown-photo"
                  src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' fill='%233B82F6'/%3E%3Ctext x='50' y='50' font-family='Arial' font-size='40' font-weight='bold' text-anchor='middle' dy='.3em' fill='white'%3EMP%3C/text%3E%3C/svg%3E"
                  alt="MPMEC Member"
                  class="w-full h-full object-cover"
                  onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
                />
                <div class="w-full h-full bg-gradient-to-br from-blue-600 to-blue-700 flex items-center justify-center" style="display: none;">
                  <span id="lgu-pmt-dropdown-initials" class="text-white font-bold text-lg">MP</span>
                </div>
              </div>
              <div class="flex-1 min-w-0">
                <p id="lgu-pmt-dropdown-name" class="text-sm font-semibold text-white truncate">Loading...</p>
                <p class="text-xs text-blue-200/80 truncate">Municipal Project Monitoring</p>
                <div class="flex items-center gap-2 mt-1">
                  <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                  <span class="text-xs text-green-300 font-medium">Active</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Menu Items -->
          <div class="py-2">
            <!-- Profile Section -->
            <div class="px-3 py-2">
              <a href="/dashboard/lgu-pmt-mpmec/modules/committee-profile" class="group flex items-center px-3 py-3 text-sm text-blue-100 hover:bg-blue-500/20 hover:text-blue-200 rounded-xl transition-all duration-200 hover:scale-[1.02]">
                <div class="w-8 h-8 rounded-lg bg-blue-500/30 flex items-center justify-center mr-3 group-hover:bg-blue-500/40 transition-colors">
                  <svg class="w-4 h-4 text-blue-300 group-hover:text-blue-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                  </svg>
                </div>
                <div>
                  <span class="font-medium">My Profile</span>
                  <p class="text-xs text-blue-300/70 group-hover:text-blue-200/80">View & edit profile</p>
                </div>
              </a>
            </div>

            <!-- Project Monitoring Section -->
            <div class="px-3 py-2">
              <a href="/dashboard/mpmec/projects" class="group flex items-center px-3 py-3 text-sm text-blue-100 hover:bg-emerald-500/20 hover:text-emerald-200 rounded-xl transition-all duration-200 hover:scale-[1.02]">
                <div class="w-8 h-8 rounded-lg bg-emerald-500/30 flex items-center justify-center mr-3 group-hover:bg-emerald-500/40 transition-colors">
                  <svg class="w-4 h-4 text-emerald-300 group-hover:text-emerald-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                  </svg>
                </div>
                <div>
                  <span class="font-medium">Project Monitoring</span>
                  <p class="text-xs text-blue-300/70 group-hover:text-emerald-200/80">Track project progress</p>
                </div>
              </a>
            </div>

            <!-- Committee Management Section -->
            <div class="px-3 py-2">
              <a href="/dashboard/mpmec/committee" class="group flex items-center px-3 py-3 text-sm text-blue-100 hover:bg-indigo-500/20 hover:text-indigo-200 rounded-xl transition-all duration-200 hover:scale-[1.02]">
                <div class="w-8 h-8 rounded-lg bg-indigo-500/30 flex items-center justify-center mr-3 group-hover:bg-indigo-500/40 transition-colors">
                  <svg class="w-4 h-4 text-indigo-300 group-hover:text-indigo-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                  </svg>
                </div>
                <div>
                  <span class="font-medium">Committee Profile</span>
                  <p class="text-xs text-blue-300/70 group-hover:text-indigo-200/80">Manage committee info</p>
                </div>
              </a>
            </div>

            <!-- Feedback & Reports Section -->
            <div class="px-3 py-2">
              <a href="/dashboard/mpmec/feedback" class="group flex items-center px-3 py-3 text-sm text-blue-100 hover:bg-amber-500/20 hover:text-amber-200 rounded-xl transition-all duration-200 hover:scale-[1.02]">
                <div class="w-8 h-8 rounded-lg bg-amber-500/30 flex items-center justify-center mr-3 group-hover:bg-amber-500/40 transition-colors">
                  <svg class="w-4 h-4 text-amber-300 group-hover:text-amber-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                  </svg>
                </div>
                <div>
                  <span class="font-medium">Feedback & Reports</span>
                  <p class="text-xs text-blue-300/70 group-hover:text-amber-200/80">Send feedback & reports</p>
                </div>
              </a>
            </div>

            <!-- Divider -->
            <div class="mx-3 my-2 border-t border-blue-600/30"></div>

            <!-- Logout Section -->
            <div class="px-3 py-2">
              <button id="lgu-pmt-dropdown-logout-btn" class="group flex items-center w-full px-3 py-3 text-sm text-red-400 hover:bg-red-500/20 hover:text-red-300 rounded-xl transition-all duration-200 hover:scale-[1.02] text-left">
                <div class="w-8 h-8 rounded-lg bg-red-500/30 flex items-center justify-center mr-3 group-hover:bg-red-500/40 transition-colors">
                  <svg class="w-4 h-4 text-red-400 group-hover:text-red-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                  </svg>
                </div>
                <div>
                  <span class="font-medium">Sign Out</span>
                  <p class="text-xs text-blue-300/70 group-hover:text-red-200/80">Secure logout</p>
                </div>
              </button>
            </div>
          </div>

          <!-- Footer -->
          <div class="px-4 py-3 border-t border-blue-600/30" style="background: linear-gradient(135deg, rgba(30, 58, 138, 0.15) 0%, rgba(37, 99, 235, 0.1) 100%);">
            <div class="flex items-center justify-between text-xs text-blue-300/70">
              <span>Session: Active</span>
              <span class="text-green-400">●</span>
            </div>
          </div>
        </div>
      </div>
    </div>


    
  </div>
  </div>
</header>

<!-- Overlay for notification sidebar -->
<div class="fixed inset-0 bg-black/50 z-[1050] hidden transition-opacity duration-300" id="lgu-pmt-notification-overlay"></div>

<!-- Enhanced MPMEC Notification Panel -->
<div class="fixed top-0 right-0 h-full w-[420px] bg-gradient-to-br from-blue-900 via-blue-800 to-blue-900 shadow-2xl border-l border-blue-400/30 z-[1200] backdrop-blur-xl transform translate-x-full transition-all duration-500 ease-out hidden" id="lgu-pmt-notification-dropdown">
  <!-- Enhanced Header with MPMEC Theme -->
  <div class="p-5 border-b border-blue-400/15 bg-gradient-to-r from-blue-800/50 via-blue-700/70 to-blue-800/50 backdrop-blur-md shadow-lg">
    <div class="flex items-center justify-between mb-4">
      <div class="flex items-center gap-3">
        <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center shadow-xl">
          <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5 5v-5z"></path>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
          </svg>
        </div>
        <div>
          <h3 class="text-xl font-bold text-white mb-1">MPMEC Notifications</h3>
          <p class="text-xs text-blue-200 font-medium">Monitor project updates & committee alerts</p>
        </div>
      </div>
      <button class="text-blue-200 hover:text-white transition-all duration-200 hover:scale-110 p-2.5 rounded-lg hover:bg-white/10 hover:shadow-lg" id="lgu-pmt-close-notifications" title="Close notifications">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>
    
    <!-- Enhanced Action Buttons with Better Hover Behavior -->
    <div class="flex items-center gap-3 mb-6">
      <button class="group flex items-center gap-3 text-sm font-semibold text-white bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 transition-all duration-300 ease-out px-4 py-3 rounded-xl border-2 border-blue-400/50 hover:border-blue-400/70 hover:shadow-2xl shadow-lg hover:-translate-y-1 transform" id="lgu-pmt-mark-all-read">
        <svg class="w-5 h-5 transition-transform duration-300 group-hover:scale-110" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        Mark all read
      </button>
      <button class="group flex items-center gap-3 text-sm font-semibold text-white bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 transition-all duration-300 ease-out px-4 py-3 rounded-xl border-2 border-red-400/50 hover:border-red-400/70 hover:shadow-2xl shadow-lg hover:-translate-y-1 transform" id="lgu-pmt-delete-all-read">
        <svg class="w-5 h-5 transition-transform duration-300 group-hover:scale-110" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
        </svg>
        Delete read
      </button>
      <button class="group flex items-center gap-3 text-sm font-semibold text-white bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 transition-all duration-300 ease-out px-4 py-3 rounded-xl border-2 border-red-500/50 hover:border-red-500/70 hover:shadow-2xl shadow-lg hover:-translate-y-1 transform" id="lgu-pmt-delete-all-notifications">
        <svg class="w-5 h-5 transition-transform duration-300 group-hover:scale-110" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
        </svg>
        Delete all
      </button>
    </div>
    
    <!-- Enhanced Minimalist Notification Stats Bar -->
    <div class="p-4 bg-gradient-to-r from-blue-500/15 to-blue-600/15 rounded-xl border border-blue-400/25 shadow-md">
      <div class="flex items-center justify-between text-xs">
        <div class="flex items-center gap-2">
          <span class="text-blue-200 font-medium">Total:</span>
          <span id="lgu-pmt-notification-total" class="text-white font-bold text-base">0</span>
        </div>
        <div class="w-px h-5 bg-blue-400/30"></div>
        <div class="flex items-center gap-2">
          <span class="text-blue-200 font-medium">Unread:</span>
          <span id="lgu-pmt-notification-unread" class="text-white font-bold text-base">0</span>
        </div>
        <div class="w-px h-5 bg-blue-400/30"></div>
        <div class="flex items-center gap-2">
          <span class="text-blue-200 font-medium">Read:</span>
          <span id="lgu-pmt-notification-read" class="text-white font-bold text-base">0</span>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Enhanced Notification List with Categories -->
  <div class="flex-1 overflow-y-auto custom-scrollbar" id="lgu-pmt-notification-list">
    <!-- Loading State -->
    <div class="p-6 text-center text-blue-200" id="lgu-pmt-notification-loading">
      <div class="animate-pulse flex flex-col items-center justify-center">
        <div class="w-16 h-16 rounded-full bg-gradient-to-br from-blue-500/20 to-blue-600/20 flex items-center justify-center mb-4">
          <svg class="w-8 h-8 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5 5v-5z"></path>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
          </svg>
        </div>
        <span class="text-sm font-medium">Loading MPMEC notifications...</span>
        <p class="text-xs text-blue-300 mt-1">Monitoring project updates & committee alerts</p>
      </div>
    </div>
  </div>
  
  <!-- Enhanced Footer with MPMEC Monitor Active - Maximized Space and Enhanced UI -->
  <div class="mt-auto p-4 border-t-2 border-blue-400/20 bg-gradient-to-r from-blue-800/80 via-blue-700/90 to-blue-800/80 backdrop-blur-md shadow-2xl">
    <div class="flex items-center justify-between text-sm text-white font-semibold">
      <div class="flex items-center gap-3">
        <div class="w-3 h-3 bg-gradient-to-r from-green-400 to-emerald-500 rounded-full animate-pulse shadow-lg"></div>
        <span class="tracking-wide">MPMEC Monitor Active</span>
      </div>
      <div class="flex items-center gap-2">
        <span class="text-blue-300 text-lg">●</span>
        <span class="text-xs text-blue-200 opacity-75">Live</span>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', async function() {
    let authService, notificationService, projectsService, lgupmtService;
    
    try {
      const [auth, notification, projects, lgupmt] = await Promise.all([
        import('../services/auth.js'),
        import('../services/notifications.js'),
        import('../services/projects.js'),
        import('../services/admin.js') // Using admin service as fallback
      ]);
      
      authService = auth.default;
      notificationService = notification.default;
      projectsService = projects.default;
      lgupmtService = lgupmt.default;
      
      window.authService = authService;
      window.notificationService = notificationService;
      console.log('✅ LGU-PMT Services loaded successfully');
    } catch (error) {
      console.error('❌ Failed to load LGU-PMT services:', error);
      window.notificationService = createFallbackNotificationService();
    }

    // ✅ FIXED: Prevent race condition with sidebar user data loading
    // Use global lock to prevent conflicts with sidebar
    if (!window.lgupmtUserDataLock) window.lgupmtUserDataLock = false;
    let isTopbarLoadingUserData = false;
    
    try {
      // Prevent multiple simultaneous loads (use global lock)
      if (isTopbarLoadingUserData || window.lgupmtUserDataLock) {
        console.log('⏳ LGU-PMT Topbar: User data loading already in progress, skipping...');
        return;
      }
      
      isTopbarLoadingUserData = true;
      window.lgupmtUserDataLock = true;
      console.log('🔄 LGU-PMT Topbar: Starting user data load...');
      
      // ✅ FIXED: Always fetch fresh data from API first
      console.log('🌐 LGU-PMT Topbar: Fetching fresh user data from API...');
      
      await new Promise(resolve => setTimeout(resolve, 200)); // Small delay to let sidebar finish first
      
      try {
        const response = await fetch('http://localhost:3000/api/auth/profile', {
          headers: {
            'Authorization': `Bearer ${localStorage.getItem('token')}`,
            'Cache-Control': 'no-cache',
            'Pragma': 'no-cache'
          }
        });
        
        if (response.ok) {
          const responseData = await response.json();
          if (responseData.success && responseData.user) {
            console.log('✅ LGU-PMT Topbar: Fresh API user data loaded:', responseData.user.fullName || responseData.user.name);
            updateLGUPMTUserData(responseData.user);
            
            // Update localStorage with fresh data (if not already updated by sidebar)
            localStorage.setItem('user', JSON.stringify(responseData.user));
            
            // Also update the auth service's current user
            if (window.authService && typeof window.authService.currentUser !== 'undefined') {
              window.authService.currentUser = responseData.user;
            }
          } else {
            console.error('❌ LGU-PMT Topbar: API returned invalid response');
            // Fallback to cached data if API fails
            const currentUser = authService.getCurrentUser();
            if (currentUser) {
              console.log('⚠️ LGU-PMT Topbar: Using cached user data as fallback:', currentUser.fullName || currentUser.name);
              updateLGUPMTUserData(currentUser);
            }
          }
        } else {
          console.error('❌ LGU-PMT Topbar: API request failed:', response.status);
          // Fallback to cached data if API fails
          const currentUser = authService.getCurrentUser();
          if (currentUser) {
            console.log('⚠️ LGU-PMT Topbar: Using cached user data as fallback:', currentUser.fullName || currentUser.name);
            updateLGUPMTUserData(currentUser);
          }
        }
      } catch (error) {
        console.error('❌ LGU-PMT Topbar: Failed to fetch user profile:', error);
        // Fallback to cached data if API fails
        const currentUser = authService.getCurrentUser();
        if (currentUser) {
          console.log('⚠️ LGU-PMT Topbar: Using cached user data as fallback:', currentUser.fullName || currentUser.name);
          updateLGUPMTUserData(currentUser);
        }
      }
      
      isTopbarLoadingUserData = false;
      window.lgupmtUserDataLock = false;
    } catch (error) {
      console.error('❌ LGU-PMT Topbar: Error loading user data:', error);
      isTopbarLoadingUserData = false;
      window.lgupmtUserDataLock = false;
    }

    // Initialize components
    initializeNotifications(notificationService);
    initializeUserDropdown();
    startLGUPMTClock();
    
    // Initialize profile dropdown functionality
    initializeLGUPMTProfileDropdown();
    
    // Dropdown logout handler
    const dropdownLogoutBtn = document.getElementById('lgu-pmt-dropdown-logout-btn');
    if (dropdownLogoutBtn) {
      dropdownLogoutBtn.addEventListener('click', function() {
        authService.logout();
      });
    }
  });
  
  // ✅ FIXED: Function to update LGU-PMT user data - simplified and reliable
  function updateLGUPMTUserData(userData) {
    console.log('🎯 LGU-PMT Topbar: Updating user data:', {
      fullName: userData.fullName || userData.name,
      role: userData.role,
      userId: userData.userId
    });
    
    // Update user name with smart abbreviation for long names
    const userNameElement = document.getElementById('lgu-pmt-user-name');
    if (userNameElement && userData && (userData.fullName || userData.name)) {
      const fullName = userData.fullName || userData.name;
      
      // Create smart abbreviation for long names
      let displayName = fullName;
      if (fullName.length > 25) {
        if (fullName.includes('Viewer Admin')) {
          displayName = fullName.replace('Viewer Admin', 'Viewer');
        } else if (fullName.includes('Management Office')) {
          displayName = fullName.replace('Management Office', 'Mgmt. Office');
        } else {
          displayName = fullName.substring(0, 22) + '...';
        }
      }
      
      console.log('📝 LGU-PMT Topbar: Setting name from', fullName, 'to', displayName);
      userNameElement.textContent = displayName;
      userNameElement.title = fullName; // Show full name on hover
    }
    
    // Update dropdown name
    const dropdownNameElement = document.getElementById('lgu-pmt-dropdown-name');
    if (dropdownNameElement && userData && (userData.fullName || userData.name)) {
      const fullName = userData.fullName || userData.name;
      console.log('📝 LGU-PMT Topbar: Setting dropdown name to', fullName);
      dropdownNameElement.textContent = fullName;
    }
    
    // Update user role - show actual role from database
    const userRoleElement = document.getElementById('lgu-pmt-user-role');
    if (userRoleElement && userData && userData.role) {
      const roleDisplay = userData.role;
      console.log('🎭 LGU-PMT Topbar: Setting role to', roleDisplay);
      userRoleElement.textContent = roleDisplay;
    }
    
    // ✅ FIXED: Load actual profile pictures for topbar and dropdown
    loadLGUPMTTopbarProfilePictures();
    
    // Update user initials (for fallback)
    const userInitialsElement = document.getElementById('lgu-pmt-user-initials');
    if (userInitialsElement && userData) {
      const fullName = userData.fullName || userData.name || '';
      const initials = fullName.split(' ')
        .map(name => name.charAt(0))
        .join('')
        .toUpperCase()
        .slice(0, 2);
      userInitialsElement.textContent = initials || 'MV';
    }
    
    // Update dropdown initials (for fallback)
    const dropdownInitialsElement = document.getElementById('lgu-pmt-dropdown-initials');
    if (dropdownInitialsElement && userData) {
      const fullName = userData.fullName || userData.name || '';
      const initials = fullName.split(' ')
        .map(name => name.charAt(0))
        .join('')
        .toUpperCase()
        .slice(0, 2);
      dropdownInitialsElement.textContent = initials || 'MV';
    }
    
    console.log('✅ LGU-PMT Topbar: User data update completed');
  }
  
  // Load profile picture from server or localStorage for topbar and dropdown (MPMEC-style)
  async function loadLGUPMTTopbarProfilePictures() {
    try {
      // Get actual user ID from localStorage
      const userData = localStorage.getItem('user');
      let userId = 'MP-0001'; // Default fallback
      if (userData) {
        try {
          const user = JSON.parse(userData);
          userId = user.employeeId || user.username || user.id || user.userId || 'MP-0001';
        } catch (error) {
          console.warn('⚠️ Error parsing user data in LGU-PMT topbar, using default userId');
        }
      }
      
      // First try to get from server
      console.log('LGU-PMT Topbar: Fetching profile picture from server for userId:', userId);
      const response = await fetch(`http://localhost:3000/api/profile/picture/${userId}`);
      
      if (response.ok) {
        const result = await response.json();
        if (result.success && result.profilePictureUrl) {
          console.log('LGU-PMT Topbar: Profile picture loaded from server:', result.profilePictureUrl);
          
          // Preload the image to prevent blinking
          const img = new Image();
          img.onload = function() {
            // Update the topbar profile picture
            const topbarProfilePic = document.getElementById('lgu-pmt-topbar-profile-picture');
            if (topbarProfilePic) {
              topbarProfilePic.src = result.profilePictureUrl;
              // Hide fallback div if it exists
              const fallbackDiv = topbarProfilePic.nextElementSibling;
              if (fallbackDiv) {
                fallbackDiv.style.display = 'none';
              }
            }
            
            // Update the dropdown profile picture
            const dropdownProfilePic = document.getElementById('lgu-pmt-dropdown-photo');
            if (dropdownProfilePic) {
              dropdownProfilePic.src = result.profilePictureUrl;
              // Hide fallback div if it exists
              const fallbackDiv = dropdownProfilePic.nextElementSibling;
              if (fallbackDiv) {
                fallbackDiv.style.display = 'none';
              }
            }
          };
          img.src = result.profilePictureUrl;
          
          // Store in localStorage for future use
          localStorage.setItem('mpmec_profile_picture', result.profilePictureUrl);
          return;
        }
      }
    } catch (error) {
      console.log('LGU-PMT Topbar: Server fetch failed, trying localStorage:', error);
    }
    
    // Fallback to localStorage if server fails
    const storedUrl = localStorage.getItem('mpmec_profile_picture');
    if (storedUrl) {
      // Preload the image to prevent blinking
      const img = new Image();
      img.onload = function() {
        const topbarProfilePic = document.getElementById('lgu-pmt-topbar-profile-picture');
        if (topbarProfilePic) {
          topbarProfilePic.src = storedUrl;
          // Hide fallback div if it exists
          const fallbackDiv = topbarProfilePic.nextElementSibling;
          if (fallbackDiv) {
            fallbackDiv.style.display = 'none';
          }
        }
        
        const dropdownProfilePic = document.getElementById('lgu-pmt-dropdown-photo');
        if (dropdownProfilePic) {
          dropdownProfilePic.src = storedUrl;
          // Hide fallback div if it exists
          const fallbackDiv = dropdownProfilePic.nextElementSibling;
          if (fallbackDiv) {
            fallbackDiv.style.display = 'none';
          }
        }
      };
      img.src = storedUrl;
    }
  }
  // Listen for profile picture updates
  window.addEventListener('mpmecProfilePictureUpdated', function(e) {
    if (e.detail.profilePictureUrl) {
      // Preload the image to prevent blinking
      const img = new Image();
      img.onload = function() {
        const topbarProfilePic = document.getElementById('lgu-pmt-topbar-profile-picture');
        if (topbarProfilePic) {
          topbarProfilePic.src = e.detail.profilePictureUrl;
          // Hide fallback div if it exists
          const fallbackDiv = topbarProfilePic.nextElementSibling;
          if (fallbackDiv) {
            fallbackDiv.style.display = 'none';
          }
        }
        
        const dropdownProfilePic = document.getElementById('lgu-pmt-dropdown-photo');
        if (dropdownProfilePic) {
          dropdownProfilePic.src = e.detail.profilePictureUrl;
          // Hide fallback div if it exists
          const fallbackDiv = dropdownProfilePic.nextElementSibling;
          if (fallbackDiv) {
            fallbackDiv.style.display = 'none';
          }
        }
      };
      img.src = e.detail.profilePictureUrl;
      
      // Store in localStorage for future use
      localStorage.setItem('mpmec_profile_picture', e.detail.profilePictureUrl);
    }
  });

  // Create fallback notification service
  function createFallbackNotificationService() {
    return {
      getNotificationCount: () => Promise.resolve(0),
      getNotifications: () => Promise.resolve({ notifications: [] }),
      markAsRead: () => Promise.resolve(true),
      markAllAsRead: () => Promise.resolve(true),
      deleteNotification: () => Promise.resolve(true),
      deleteAllRead: () => Promise.resolve(true),
      onUpdate: () => {},
      getNotificationIcon: () => '<div class="w-6 h-6 bg-blue-500 rounded-full"></div>',
      formatTime: (date) => 'Recently'
    };
  }

  // Notification functionality
  function initializeNotifications(notificationService) {
    const notificationBtn = document.getElementById('lgu-pmt-notification-btn');
    const notificationDropdown = document.getElementById('lgu-pmt-notification-dropdown');
    const notificationBadge = document.getElementById('lgu-pmt-notification-badge');
    const notificationList = document.getElementById('lgu-pmt-notification-list');
    const markAllReadBtn = document.getElementById('lgu-pmt-mark-all-read');
    
    if (!notificationBtn || !notificationDropdown) {
      console.error('❌ LGU-PMT Notification elements not found');
      return;
    }
    
    console.log('✅ Initializing LGU-PMT notification functionality');
    
    const notificationOverlay = document.getElementById('lgu-pmt-notification-overlay');
    const closeNotificationBtn = document.getElementById('lgu-pmt-close-notifications');
    
    notificationBtn.addEventListener('click', (e) => {
      console.log('🔔 LGU-PMT Notification button clicked');
      e.preventDefault();
      e.stopPropagation();
      
      if (!notificationOverlay) {
        console.error('❌ LGU-PMT notification overlay not found!');
        return;
      }
      
      const isHidden = notificationDropdown.classList.contains('hidden');
      if (isHidden) {
        console.log('📂 Opening LGU-PMT notification sidebar');
        console.log('🖤 Showing overlay with bg-black/50');
        
        // Show overlay first
        notificationOverlay.classList.remove('hidden');
        notificationOverlay.style.opacity = '0';
        
        // Show sidebar
        notificationDropdown.classList.remove('hidden');
        notificationDropdown.style.visibility = 'visible';
        notificationDropdown.style.opacity = '1';
        notificationDropdown.style.transform = 'translateX(100%)';
        
        // Animate both together
        requestAnimationFrame(() => {
          notificationOverlay.style.opacity = '1';
          notificationDropdown.style.transform = 'translateX(0)';
        });
        
        loadNotifications(notificationService);
      } else {
        console.log('📁 Closing LGU-PMT notification sidebar');
        closeSidebar();
      }
    });
    
    function closeSidebar() {
      notificationDropdown.style.transform = 'translateX(100%)';
      notificationOverlay.style.opacity = '0';
      setTimeout(() => {
        notificationDropdown.classList.add('hidden');
        notificationOverlay.classList.add('hidden');
        // Ensure proper visibility state
        notificationDropdown.style.visibility = 'hidden';
        notificationDropdown.style.opacity = '0';
      }, 300);
    }
    
    if (closeNotificationBtn) {
      closeNotificationBtn.addEventListener('click', closeSidebar);
    }
    
    if (notificationOverlay) {
      notificationOverlay.addEventListener('click', closeSidebar);
    }
    
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && !notificationDropdown.classList.contains('hidden')) {
        closeSidebar();
      }
    });
    
    markAllReadBtn.addEventListener('click', async () => {
      await notificationService.markAllAsRead();
      updateNotificationBadge(notificationService);
      loadNotifications(notificationService);
    });
    
    const deleteAllReadBtn = document.getElementById('lgu-pmt-delete-all-read');
    if (deleteAllReadBtn) {
      deleteAllReadBtn.addEventListener('click', async () => {
        if (confirm('Are you sure you want to delete all read notifications?')) {
          await notificationService.deleteAllRead();
          updateNotificationBadge(notificationService);
          loadNotifications(notificationService);
        }
      });
    }

    const deleteAllNotificationsBtn = document.getElementById('lgu-pmt-delete-all-notifications');
    if (deleteAllNotificationsBtn) {
      deleteAllNotificationsBtn.addEventListener('click', async () => {
        if (confirm('Are you sure you want to delete ALL notifications? This action cannot be undone and will clear both read and unread notifications.')) {
          try {
            const data = await notificationService.getNotifications();
            const allNotifications = data.notifications || [];
            
            let deletedCount = 0;
            for (const notification of allNotifications) {
              const success = await notificationService.deleteNotification(notification.id);
              if (success) deletedCount++;
            }
            
            if (deletedCount > 0) {
              updateNotificationBadge(notificationService);
              loadNotifications(notificationService);
              console.log(`🗑️ Successfully deleted ${deletedCount} notifications`);
            }
          } catch (error) {
            console.error('Error deleting all notifications:', error);
            alert('Failed to delete all notifications. Please try again.');
          }
        }
      });
    }
    
    updateNotificationBadge(notificationService);
    
    notificationService.onUpdate(({ count }) => {
      updateNotificationBadge(notificationService, count);
    });
  }

  async function updateNotificationBadge(notificationService, count) {
    const badge = document.getElementById('lgu-pmt-notification-badge');
    const totalEl = document.getElementById('lgu-pmt-notification-total');
    const unreadEl = document.getElementById('lgu-pmt-notification-unread');
    const readEl = document.getElementById('lgu-pmt-notification-read');
    
    if (!notificationService) return;
    
    try {
      const currentCount = count !== undefined ? count : await notificationService.getNotificationCount();
      const notifications = await notificationService.getNotifications();
      const allNotifications = notifications.notifications || [];
      const readCount = allNotifications.filter(n => n.isRead).length;
      const unreadCount = allNotifications.length - readCount;
      
      // Update badge
      if (currentCount > 0) {
        badge.textContent = currentCount > 99 ? '99+' : currentCount;
        badge.classList.remove('hidden');
      } else {
        badge.classList.add('hidden');
      }
      
      // Update stats
      if (totalEl) totalEl.textContent = allNotifications.length;
      if (unreadEl) unreadEl.textContent = unreadCount;
      if (readEl) readEl.textContent = readCount;
      
    } catch (error) {
      console.error('Error updating MPMEC notification badge:', error);
      badge.classList.add('hidden');
    }
  }

  async function loadNotifications(notificationService) {
    const notificationList = document.getElementById('lgu-pmt-notification-list');
    const loadingEl = document.getElementById('lgu-pmt-notification-loading');
    if (!notificationService) return;
    
    try {
      // Hide loading state
      if (loadingEl) loadingEl.style.display = 'none';
      
      const data = await notificationService.getNotifications();
      const notifications = data.notifications || [];

      if (notifications.length === 0) {
        notificationList.innerHTML = `
          <div class="p-8 text-center text-blue-200">
            <div class="w-20 h-20 rounded-full bg-gradient-to-br from-blue-500/10 to-blue-600/10 flex items-center justify-center mx-auto mb-4">
              <svg class="w-10 h-10 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
            </div>
            <h4 class="text-lg font-semibold text-white mb-2">All Caught Up!</h4>
            <p class="text-sm text-blue-200">No MPMEC notifications at the moment</p>
            <p class="text-xs text-blue-300 mt-1">All projects are running smoothly</p>
          </div>
        `;
        return;
      }

      const notificationsHtml = notifications.map(notification => {
        const priorityColors = {
          high: 'from-red-500/20 to-red-600/20 border-red-500/30',
          medium: 'from-yellow-500/20 to-orange-500/20 border-yellow-500/30',
          low: 'from-blue-500/20 to-blue-600/20 border-blue-500/30',
          info: 'from-blue-500/20 to-blue-600/20 border-blue-500/30'
        };
        
        const priorityColor = priorityColors[notification.priority] || priorityColors.info;
        const isUnread = !notification.isRead;
        
        return `
          <div class="p-4 hover:bg-white/5 transition-all duration-200 ${isUnread ? 'bg-gradient-to-r from-blue-500/5 to-blue-600/5' : ''}" 
               data-notification-id="${notification.id}">
            <div class="flex items-start gap-4">
              <!-- Priority Indicator -->
              <div class="flex-shrink-0">
                <div class="w-3 h-3 rounded-full ${isUnread ? 'bg-gradient-to-r from-green-400 to-green-500 animate-pulse' : 'bg-gray-500'}"></div>
              </div>
              
              <!-- Notification Icon -->
              <div class="flex-shrink-0">
                <div class="w-10 h-10 rounded-lg bg-gradient-to-br ${priorityColor} flex items-center justify-center">
                  ${notificationService.getNotificationIcon(notification.type, notification.category, notification.metadata)}
                </div>
              </div>
              
              <!-- Notification Content -->
              <div class="flex-1 min-w-0">
                <div class="flex items-start justify-between gap-2">
                  <div class="flex-1">
                    <h4 class="text-sm font-semibold text-white mb-1">${notification.title || 'MPMEC Notification'}</h4>
                    <p class="text-sm text-blue-200 leading-relaxed">${notification.message || 'No message content'}</p>
                    
                    <!-- Action Buttons -->
                    ${notification.actionUrl ? `
                      <div class="flex items-center gap-2 mt-3">
                        <a href="${notification.actionUrl}" class="inline-flex items-center gap-2 text-xs text-blue-300 hover:text-blue-200 transition-colors px-3 py-1.5 rounded-lg border border-blue-400/30 hover:bg-blue-400/10 hover:border-blue-400/50">
                          <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                          </svg>
                          ${notification.actionText || 'View Details'}
                        </a>
                      </div>
                    ` : ''}
                  </div>
                  
                  <!-- Time and Actions -->
                  <div class="flex flex-col items-end gap-2">
                    <span class="text-xs text-blue-300 whitespace-nowrap">${notificationService.formatTime(notification.createdAt)}</span>
                    <div class="flex items-center gap-1">
                      ${!notification.isRead ? `
                        <button class="group flex items-center gap-2 text-sm font-semibold text-white bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 transition-all duration-300 ease-out px-3 py-2 rounded-xl border-2 border-green-400/50 hover:border-green-400/70 hover:shadow-2xl shadow-lg hover:-translate-y-1 transform" 
                                onclick="markLGUPMTNotificationAsRead('${notification.id}')" 
                                title="Mark as read">
                          <svg class="w-4 h-4 transition-transform duration-300 group-hover:scale-110" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                          </svg>
                        </button>
                      ` : ''}
                      <button class="group flex items-center gap-2 text-sm font-semibold text-white bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 transition-all duration-300 ease-out px-3 py-2 rounded-xl border-2 border-red-400/50 hover:border-red-400/70 hover:shadow-2xl shadow-lg hover:-translate-y-1 transform" 
                              onclick="deleteLGUPMTNotification('${notification.id}')" 
                              title="Delete notification">
                        <svg class="w-4 h-4 transition-transform duration-300 group-hover:scale-110" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                        </svg>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        `;
      }).join('');

      notificationList.innerHTML = notificationsHtml;
      
      // Add dividers between notifications
      const notificationItems = notificationList.querySelectorAll('[data-notification-id]');
      notificationItems.forEach((item, index) => {
        if (index < notificationItems.length - 1) {
          const divider = document.createElement('div');
          divider.className = 'mx-4 border-t border-blue-400/10';
          item.after(divider);
        }
      });
      
    } catch (error) {
      console.error('Error loading MPMEC notifications:', error);
      notificationList.innerHTML = `
        <div class="p-6 text-center text-red-400">
          <div class="w-16 h-16 rounded-full bg-red-500/10 flex items-center justify-center mx-auto mb-4">
            <svg class="w-8 h-8 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.34 16.500c-.77.833.192 2.5 1.732 2.5z"></path>
            </svg>
          </div>
          <h4 class="text-sm font-semibold text-red-300 mb-2">Connection Error</h4>
          <p class="text-sm text-red-200">Failed to load MPMEC notifications</p>
          <p class="text-xs text-red-300 mt-1">Check your connection and try again</p>
        </div>
      `;
    }
  }

  // Global functions for notification actions
  window.markLGUPMTNotificationAsRead = async function(notificationId) {
    await window.notificationService.markAsRead(notificationId);
    updateNotificationBadge(window.notificationService);
    loadNotifications(window.notificationService);
  };

  window.deleteLGUPMTNotification = async function(notificationId) {
    if (confirm('Are you sure you want to delete this notification?')) {
      const success = await window.notificationService.deleteNotification(notificationId);
      if (success) {
        updateNotificationBadge(window.notificationService);
        loadNotifications(window.notificationService);
      } else {
        alert('Failed to delete notification. Please try again.');
      }
    }
  };

  // User dropdown functionality
  function initializeUserDropdown() {
    const userDropdownBtn = document.getElementById('lgu-pmt-user-dropdown-btn');
    const userDropdown = document.getElementById('lgu-pmt-user-dropdown');
    const userDropdownContainer = userDropdownBtn?.parentElement;
    
    if (userDropdownBtn && userDropdown && userDropdownContainer) {
      let hoverTimeout;
      
      // Show on hover
      userDropdownContainer.addEventListener('mouseenter', () => {
        clearTimeout(hoverTimeout);
        userDropdown.classList.remove('hidden');
      });
      
      // Hide on mouse leave with small delay
      userDropdownContainer.addEventListener('mouseleave', () => {
        hoverTimeout = setTimeout(() => {
          userDropdown.classList.add('hidden');
        }, 150);
      });
      
      // Also show on click for mobile/touch devices
      userDropdownBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        userDropdown.classList.toggle('hidden');
      });
      
      // Close dropdown when clicking outside
      document.addEventListener('click', (e) => {
        if (!e.target.closest('#lgu-pmt-user-dropdown-btn') && !e.target.closest('#lgu-pmt-user-dropdown')) {
          userDropdown.classList.add('hidden');
        }
      });
    }
  }

  // Clock functionality
  function startLGUPMTClock() {
    const clockElement = document.getElementById('lgu-pmt-current-date');
    
    function updateClock() {
      const now = new Date();
      const options = { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit',
        timeZone: 'Asia/Manila'
      };
      
      if (clockElement) {
        clockElement.textContent = now.toLocaleDateString('en-US', options).replace(' at ', ' at ');
      }
    }
    
    updateClock();
    setInterval(updateClock, 1000);
  }

  // LGU-PMT Sidebar Toggle Functionality
  const lgupmtSidebarToggleBtn = document.getElementById('lgu-pmt-sidebar-toggle');
  const lgupmtSidebar = document.querySelector('aside'); // Target the sidebar element
  const lgupmtToggleIcon = document.getElementById('lgu-pmt-sidebar-toggle-icon');
  
  if (lgupmtSidebarToggleBtn && lgupmtSidebar && lgupmtToggleIcon) {
    console.log('🔧 Initializing LGU-PMT sidebar toggle functionality');
    
    // Icon paths
    const hamburgerIcon = "M4 6h16M4 12h16M4 18h16";
    const arrowRightIcon = "M9 5l7 7-7 7";
    
    function updateLGUPMTIcon(isCollapsed) {
      // Add smooth rotation animation
      lgupmtToggleIcon.style.transform = 'rotate(180deg)';
      lgupmtToggleIcon.style.transition = 'all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
      
      setTimeout(() => {
        const iconPath = lgupmtToggleIcon.querySelector('path');
        if (iconPath) {
          iconPath.setAttribute('d', isCollapsed ? arrowRightIcon : hamburgerIcon);
        }
        lgupmtToggleIcon.style.transform = 'rotate(0deg)';
      }, 200);
    }
    
    // Check if sidebar is collapsed from localStorage
    const isCollapsed = localStorage.getItem('lgu-pmt-sidebar-collapsed') === 'true';
    if (isCollapsed) {
      lgupmtSidebar.classList.add('collapsed');
      updateLGUPMTIcon(true);
    }
    
    lgupmtSidebarToggleBtn.addEventListener('click', () => {
      console.log('🔄 Toggling LGU-PMT sidebar');
      
      const isCurrentlyCollapsed = lgupmtSidebar.classList.contains('collapsed');
      
      if (isCurrentlyCollapsed) {
        // Expand sidebar
        lgupmtSidebar.classList.remove('collapsed');
        localStorage.setItem('lgu-pmt-sidebar-collapsed', 'false');
        updateLGUPMTIcon(false);
        console.log('📖 LGU-PMT Sidebar expanded');
      } else {
        // Collapse sidebar
        lgupmtSidebar.classList.add('collapsed');
        localStorage.setItem('lgu-pmt-sidebar-collapsed', 'true');
        updateLGUPMTIcon(true);
        console.log('📕 LGU-PMT Sidebar collapsed');
      }
    });
  } else {
    console.warn('❌ LGU-PMT sidebar toggle elements not found');
  }

  // Profile Dropdown Functionality
  function initializeLGUPMTProfileDropdown() {
    const profileBtn = document.getElementById('lgu-pmt-user-dropdown-btn');
    const profileDropdown = document.getElementById('lgu-pmt-profile-dropdown');
    const profileContainer = document.getElementById('lgu-pmt-profile-container');
    
    if (!profileBtn || !profileDropdown) {
      console.error('❌ LGU-PMT profile dropdown elements not found');
      return;
    }

    console.log('✅ Initializing LGU-PMT profile dropdown');

    // Toggle dropdown on click
    profileBtn.addEventListener('click', (e) => {
      e.preventDefault();
      e.stopPropagation();
      
      const isVisible = !profileDropdown.classList.contains('hidden');
      
      if (isVisible) {
        // Hide dropdown
        hideLGUPMTProfileDropdown();
      } else {
        // Show dropdown
        showLGUPMTProfileDropdown();
      }
    });

    // Close dropdown when clicking outside
    document.addEventListener('click', (e) => {
      if (!profileContainer.contains(e.target)) {
        hideLGUPMTProfileDropdown();
      }
    });

    // Close dropdown on escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        hideLGUPMTProfileDropdown();
      }
    });

    // Show dropdown function with smooth fade-in
    function showLGUPMTProfileDropdown() {
      // First remove hidden class to make element visible
      profileDropdown.classList.remove('hidden');
      
      // Force a reflow to ensure the element is rendered
      profileDropdown.offsetHeight;
      
      // Add showing class for smooth entrance animation
      profileDropdown.classList.add('showing');
      
      // Update button aria state
      profileBtn.setAttribute('aria-expanded', 'true');
      
      console.log('👤 LGU-PMT profile dropdown shown with smooth animation');
    }

    // Hide dropdown function with smooth fade-out
    function hideLGUPMTProfileDropdown() {
      // Remove showing class and add hiding class for smooth exit animation
      profileDropdown.classList.remove('showing');
      profileDropdown.classList.add('hiding');
      
      // Use setTimeout to ensure smooth animation before hiding
      setTimeout(() => {
        profileDropdown.classList.add('hidden');
        profileDropdown.classList.remove('hiding');
      }, 300);
      
      // Update button aria state
      profileBtn.setAttribute('aria-expanded', 'false');
      
      console.log('🙈 LGU-PMT profile dropdown hidden with smooth animation');
    }
  }
</script>

<style>
  /* Enhanced Custom Scrollbar for MPMEC Notifications */
  .custom-scrollbar {
    scrollbar-width: thin;
    scrollbar-color: rgba(59, 130, 246, 0.5) transparent;
  }
  
  .custom-scrollbar::-webkit-scrollbar {
    width: 8px;
  }
  
  .custom-scrollbar::-webkit-scrollbar-track {
    background: linear-gradient(to bottom, rgba(59, 130, 246, 0.1), rgba(59, 130, 246, 0.2));
    border-radius: 4px;
  }
  
  .custom-scrollbar::-webkit-scrollbar-thumb {
    background: linear-gradient(to bottom, rgba(59, 130, 246, 0.6), rgba(59, 130, 246, 0.7));
    border-radius: 4px;
    border: 1px solid rgba(59, 130, 246, 0.3);
  }
  
  .custom-scrollbar::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(to bottom, rgba(59, 130, 246, 0.8), rgba(59, 130, 246, 0.9));
    box-shadow: 0 0 10px rgba(59, 130, 246, 0.4);
  }
  
  /* Enhanced Notification Panel Layout and Scrolling */
  #lgu-pmt-notification-dropdown {
    display: flex;
    flex-direction: column;
    height: 100vh;
    visibility: hidden;
    opacity: 0;
  }

  #lgu-pmt-notification-dropdown:not(.hidden) {
    visibility: visible;
    opacity: 1;
    animation: slideInRight 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  }

  #lgu-pmt-notification-list {
    flex: 1;
    overflow-y: auto;
    min-height: 0;
    padding-bottom: 1rem;
  }

  /* Enhanced Footer Styling */
  #lgu-pmt-notification-dropdown > div:last-child {
    flex-shrink: 0;
    background: linear-gradient(135deg, rgba(30, 58, 138, 0.8) 0%, rgba(59, 130, 246, 0.7) 100%);
    border-top: 2px solid rgba(59, 130, 246, 0.2);
    box-shadow: 0 -4px 20px rgba(59, 130, 246, 0.2);
  }
  
  @keyframes slideInRight {
    from {
      transform: translateX(100%);
      opacity: 0;
    }
    to {
      transform: translateX(0);
      opacity: 1;
    }
  }
  
  /* Enhanced Action Button Hover Effects */
  #lgu-pmt-mark-all-read,
  #lgu-pmt-delete-all-read {
    position: relative;
    overflow: hidden;
  }

  #lgu-pmt-mark-all-read::before,
  #lgu-pmt-delete-all-read::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: left 0.5s ease;
  }

  #lgu-pmt-mark-all-read:hover::before,
  #lgu-pmt-delete-all-read:hover::before {
    left: 100%;
  }

  /* Enhanced Notification Item Hover Effects */
  #lgu-pmt-notification-list [data-notification-id] {
    border-bottom: 2px solid rgba(59, 130, 246, 0.1);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
  }

  #lgu-pmt-notification-list [data-notification-id]:hover {
    transform: translateX(6px);
    box-shadow: 0 6px 25px rgba(59, 130, 246, 0.1);
    background: rgba(59, 130, 246, 0.02);
    border-left: 4px solid #3b82f6;
  }

  #lgu-pmt-notification-list [data-notification-id]:last-child {
    border-bottom: none;
  }

  /* Enhanced notification card styling */
  #lgu-pmt-notification-list [data-notification-id] {
    margin: 0 8px;
    border-radius: 8px;
    padding: 16px;
  }

  #lgu-pmt-notification-list [data-notification-id]:hover {
    margin-left: 4px;
    margin-right: 4px;
  }
  
  /* Priority Indicator Animations */
  .animate-pulse {
    animation: priorityPulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
  }
  
  @keyframes priorityPulse {
    0%, 100% {
      opacity: 0.8;
      transform: scale(1);
    }
    50% {
      opacity: 1;
      transform: scale(1.1);
    }
  }

  /* LGU-PMT Sidebar Collapse Styles - ULTRA SMOOTH */
  :global(aside) {
    transition: all 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    width: 256px; /* w-64 default width */
    min-width: 256px;
    flex-shrink: 0;
  }

  :global(aside.collapsed) {
    width: 80px; /* w-20 collapsed width */
    min-width: 80px;
    overflow-y: hidden; /* Prevent scrollbar */
  }

  /* Override the scrollable area in collapsed state */
  :global(aside.collapsed .relative.flex-1.overflow-y-auto) {
    overflow-y: visible; /* Remove scroll in collapsed state */
  }

  /* Hide text in collapsed sidebar - SMOOTH FADE */
  :global(aside.collapsed .nav-text) {
    opacity: 0;
    pointer-events: none;
    width: 0;
    overflow: hidden;
    transition: opacity 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94), width 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  }

  /* USE PROFILE PICTURE IN COLLAPSED STATE - CENTERED */
  :global(aside.collapsed .w-14.h-14) {
    display: block !important; /* Show profile photo */
    margin: 0 auto !important; /* Center it perfectly */
  }

  :global(aside.collapsed .nav-text) {
    display: none !important;
  }

  :global(aside.collapsed .flex.items-center.gap-4) {
    display: flex !important;
    justify-content: center !important;
    align-items: center !important;
    padding: 0.75rem 0 !important; /* Standard padding */
    margin: 0 !important; /* No margin */
    position: relative !important;
    height: auto !important; /* Auto height for profile picture */
  }

  /* Navigation section - remove container padding */
  :global(aside.collapsed .relative.flex-1.overflow-y-auto.py-4) {
    padding: 0.5rem 0 !important; /* Only vertical padding */
  }

  /* Remove nav container padding in collapsed state */
  :global(aside.collapsed nav.space-y-2.px-3) {
    padding: 0 !important; /* Remove all nav padding */
    margin: 0 !important;
  }

  /* Navigation items - position to match expanded sidebar exactly */
  :global(aside.collapsed .nav-item) {
    padding: 0.75rem 0 0.75rem 1.75rem !important; /* Match expanded position */
    margin: 0.75rem 0 !important; /* Increased vertical spacing */
    justify-content: flex-start !important; /* Align to left to match expanded state */
    position: relative;
    transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  }

  /* Logout section - make it visible and properly positioned */
  :global(aside.collapsed .relative.p-6:last-child) {
    padding: 0.5rem 0 1rem 0 !important; /* Vertical padding only */
    border-top: 1px solid rgba(255, 255, 255, 0.1) !important;
    margin-top: auto !important;
    display: block !important;
  }

  :global(aside.collapsed .relative.p-6:last-child button) {
    padding: 0.75rem 0 0.75rem 1.75rem !important; /* Match nav items positioning */
    margin: 0.75rem 0 !important;
    justify-content: flex-start !important; /* Align to left to match nav items */
    width: 100%;
    display: flex !important;
  }

  /* Hide logout text in collapsed state */
  :global(aside.collapsed .relative.p-6:last-child button span) {
    display: none !important;
  }

  :global(aside.collapsed .space-y-2) {
    gap: 0.75rem !important; /* Increased gap for better icon spacing */
  }

  /* Override space-y-2 utility in collapsed state with increased spacing */
  :global(aside.collapsed nav .space-y-2 > * + *) {
    margin-top: 0.75rem !important; /* Increased spacing for better visual separation */
  }

  /* Icons - position them to match expanded state */
  :global(aside.collapsed .nav-icon) {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 20px;
    height: 20px;
    margin: 0; /* No margin - let padding handle positioning */
  }

  /* Ensure all nav text is hidden in collapsed state */
  :global(aside.collapsed .nav-text) {
    display: none !important;
    opacity: 0 !important;
    width: 0 !important;
    overflow: hidden !important;
  }

  /* Add smooth transitions to all navigation items */
  :global(.nav-item) {
    transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  }

  :global(.nav-text) {
    transition: opacity 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94), width 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  }

  :global(.nav-icon) {
    transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  }

  /* Tooltip animations and styling */
  :global(aside.collapsed .nav-item:hover::after) {
    content: attr(data-tooltip);
    position: absolute;
    left: calc(100% + 12px);
    top: 50%;
    transform: translateY(-50%);
    background: rgba(0, 0, 0, 0.9);
    color: white;
    padding: 8px 12px;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 500;
    white-space: nowrap;
    z-index: 1000;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    opacity: 0;
    animation: tooltipFadeIn 0.2s ease forwards;
  }

  @keyframes tooltipFadeIn {
    from {
      opacity: 0;
      transform: translateY(-50%) translateX(-8px);
    }
    to {
      opacity: 1;
      transform: translateY(-50%) translateX(0);
    }
  }

  /* Tooltip arrow */
  :global(aside.collapsed .nav-item:hover::before) {
    content: '';
    position: absolute;
    left: calc(100% + 6px);
    top: 50%;
    transform: translateY(-50%);
    width: 0;
    height: 0;
    border-top: 6px solid transparent;
    border-bottom: 6px solid transparent;
    border-right: 6px solid rgba(0, 0, 0, 0.9);
    z-index: 999;
    opacity: 0;
    animation: tooltipFadeIn 0.2s ease forwards;
  }

  /* Enhanced LGU-PMT Profile Dropdown Styles */
  #lgu-pmt-profile-dropdown {
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
  }

  #lgu-pmt-profile-dropdown .group:hover {
    transform: translateX(4px);
  }

  /* Smooth transitions for dropdown items */
  #lgu-pmt-profile-dropdown a,
  #lgu-pmt-profile-dropdown button {
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  }

  /* Enhanced hover effects */
  #lgu-pmt-profile-dropdown .group:hover .w-8.h-8 {
    transform: scale(1.1);
    transition: transform 0.2s ease;
  }

  /* Enhanced Topbar Button Hover Effects */
  .group:hover .group-hover\:scale-110 {
    transform: scale(1.1);
  }
  
  .group:hover .group-hover\:rotate-12 {
    transform: rotate(12deg);
  }
  
  .group:hover .group-hover\:rotate-6 {
    transform: rotate(6deg);
  }
  
  .group:hover .group-hover\:rotate-3 {
    transform: rotate(3deg);
  }
  
  /* Enhanced Profile Dropdown Animations */
  #lgu-pmt-profile-dropdown {
    transform-origin: top right;
    will-change: opacity, transform, visibility;
  }

  /* Smooth entrance animation */
  #lgu-pmt-profile-dropdown.showing {
    animation: dropdownFadeIn 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
  }

  /* Smooth exit animation */
  #lgu-pmt-profile-dropdown.hiding {
    animation: dropdownFadeOut 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards;
  }

  @keyframes dropdownFadeIn {
    from {
      opacity: 0;
      transform: scale(0.95) translateY(-10px);
      visibility: hidden;
    }
    to {
      opacity: 1;
      transform: scale(1) translateY(0);
      visibility: visible;
    }
  }

  @keyframes dropdownFadeOut {
    from {
      opacity: 1;
      transform: scale(1) translateY(0);
      visibility: visible;
    }
    to {
      opacity: 0;
      transform: scale(0.95) translateY(-10px);
      visibility: hidden;
    }
  }
</style> 