---
import Layout from "../layouts/Layout.astro";
import TopBar from "../components/TopBar.astro";
import LGUFooter from "../components/LGUFooter.astro";
import ProjectsIsland from "../islands/ProjectsIsland.jsx";
---
<Layout title="Projects | Build Watch LGU" description="View and monitor all LGU projects in Santa Cruz, Laguna.">
  <TopBar />
  <main class="flex flex-col items-center w-full px-4 pb-12 bg-transparent min-h-[60vh] fade-in-projects">
    <!-- Hero Section with Background Image -->
    <div class="w-full h-[520px] md:h-[600px] relative overflow-hidden mt-28">
      <img src="/projects-page-header-bg.png" alt="Santa Cruz Aerial" class="absolute inset-0 w-full h-full object-cover object-top select-none" draggable="false" />
    </div>
    
    <!-- Combined Analytics and Search/Filter Section -->
    <div class="w-full flex justify-center relative z-30 -mt-16">
      <div class="w-full max-w-7xl flex flex-col lg:flex-row gap-6">
        <!-- Enhanced Project Analytics Card (Left Side) -->
        <div class="lg:w-1/3">
          <div class="bg-gradient-to-br from-white/95 to-blue-50/95 backdrop-blur-sm rounded-2xl shadow-lg p-6 border border-blue-100/50 h-full relative overflow-hidden group hover:shadow-2xl transition-all duration-500">
            <!-- Decorative background elements -->
            <div class="absolute -top-10 -right-10 w-24 h-24 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full opacity-10 blur-xl"></div>
            <div class="absolute -bottom-8 -left-8 w-20 h-20 bg-gradient-to-br from-green-400 to-teal-500 rounded-full opacity-15 blur-lg"></div>
            
            <!-- Header Section -->
            <div class="relative z-10 mb-5">
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-2">
                  <div class="w-8 h-8 bg-gradient-to-br from-blue-600 to-blue-700 rounded-xl flex items-center justify-center shadow-lg">
                    <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                    </svg>
                  </div>
                  <div>
                    <h3 class="text-lg font-black text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-blue-700">
                      Project Analytics
                    </h3>
                  </div>
                </div>
                <div class="w-2 h-2 bg-blue-400 rounded-full animate-pulse"></div>
              </div>
            </div>

            <!-- Enhanced Statistics Grid -->
            <div class="relative z-10 grid grid-cols-2 gap-3 mb-4">
              <!-- Total Projects -->
              <div class="group bg-gradient-to-br from-blue-50 to-blue-100/50 rounded-lg p-3 border border-blue-200/50 hover:shadow-md transition-all duration-300">
                <div class="flex items-center justify-between mb-1">
                  <div class="w-6 h-6 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center shadow-md">
                    <svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
                    </svg>
                  </div>
                </div>
                <div class="text-2xl font-black text-blue-600 mb-1" id="total-projects">-</div>
                <div class="text-xs font-semibold text-blue-700">Total Projects</div>
                <div class="w-full h-0.5 bg-gradient-to-r from-blue-400 to-blue-600 rounded-full mt-1 transform scale-x-0 group-hover:scale-x-100 transition-transform duration-500"></div>
              </div>

              <!-- Total Departments -->
              <div class="group bg-gradient-to-br from-blue-50 to-blue-100/50 rounded-lg p-3 border border-blue-200/50 hover:shadow-md transition-all duration-300">
                <div class="flex items-center justify-between mb-1">
                  <div class="w-6 h-6 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center shadow-md">
                    <svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                    </svg>
                  </div>
                </div>
                <div class="text-2xl font-black text-blue-600 mb-1" id="total-departments">-</div>
                <div class="text-xs font-semibold text-blue-700">Total Departments</div>
                <div class="w-full h-0.5 bg-gradient-to-r from-blue-400 to-blue-600 rounded-full mt-1 transform scale-x-0 group-hover:scale-x-100 transition-transform duration-500"></div>
              </div>

              <!-- Ongoing Projects -->
              <div class="group bg-gradient-to-br from-sky-50 to-blue-100/50 rounded-lg p-3 border border-sky-200/50 hover:shadow-md transition-all duration-300">
                <div class="flex items-center justify-between mb-1">
                  <div class="w-6 h-6 bg-gradient-to-br from-sky-500 to-blue-600 rounded-lg flex items-center justify-center shadow-md">
                    <svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                    </svg>
                  </div>
                </div>
                <div class="text-2xl font-black text-sky-600 mb-1" id="ongoing-projects">-</div>
                <div class="text-xs font-semibold text-sky-700">Ongoing</div>
                <div class="w-full h-0.5 bg-gradient-to-r from-sky-400 to-blue-600 rounded-full mt-1 transform scale-x-0 group-hover:scale-x-100 transition-transform duration-500"></div>
              </div>

              <!-- Delayed Projects -->
              <div class="group bg-gradient-to-br from-red-50 to-red-100/50 rounded-lg p-3 border border-red-200/50 hover:shadow-md transition-all duration-300">
                <div class="flex items-center justify-between mb-1">
                  <div class="w-6 h-6 bg-gradient-to-br from-red-500 to-red-600 rounded-lg flex items-center justify-center shadow-md">
                    <svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                  </div>
                </div>
                <div class="text-2xl font-black text-red-600 mb-1" id="delayed-projects">-</div>
                <div class="text-xs font-semibold text-red-700">Delayed</div>
                <div class="w-full h-0.5 bg-gradient-to-r from-red-400 to-red-600 rounded-full mt-1 transform scale-x-0 group-hover:scale-x-100 transition-transform duration-500"></div>
              </div>

              <!-- Completed Projects -->
              <div class="group bg-gradient-to-br from-green-50 to-emerald-100/50 rounded-lg p-3 border border-green-200/50 hover:shadow-md transition-all duration-300">
                <div class="flex items-center justify-between mb-1">
                  <div class="w-6 h-6 bg-gradient-to-br from-green-500 to-emerald-600 rounded-lg flex items-center justify-center shadow-md">
                    <svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                  </div>
                </div>
                <div class="text-2xl font-black text-green-600 mb-1" id="completed-projects">-</div>
                <div class="text-xs font-semibold text-green-700">Completed</div>
                <div class="w-full h-0.5 bg-gradient-to-r from-green-400 to-emerald-600 rounded-full mt-1 transform scale-x-0 group-hover:scale-x-100 transition-transform duration-500"></div>
              </div>

              <!-- Average Progress -->
              <div class="group bg-gradient-to-br from-amber-50 to-yellow-100/50 rounded-lg p-3 border border-amber-200/50 hover:shadow-md transition-all duration-300">
                <div class="flex items-center justify-between mb-1">
                  <div class="w-6 h-6 bg-gradient-to-br from-amber-500 to-yellow-600 rounded-lg flex items-center justify-center shadow-md">
                    <svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"/>
                    </svg>
                  </div>
                </div>
                <div class="text-2xl font-black text-amber-600 mb-1" id="avg-progress">-</div>
                <div class="text-xs font-semibold text-amber-700">Avg Progress</div>
                <div class="w-full h-0.5 bg-gradient-to-r from-amber-400 to-yellow-600 rounded-full mt-1 transform scale-x-0 group-hover:scale-x-100 transition-transform duration-500"></div>
              </div>
            </div>

            <!-- Enhanced Budget Section -->
            <div class="relative z-10 bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg p-3 border border-green-200/50 shadow-inner">
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-2">
                  <div class="w-6 h-6 bg-gradient-to-br from-green-500 to-emerald-600 rounded-lg flex items-center justify-center shadow-lg">
                    <svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                  </div>
                  <div>
                    <div class="text-xs font-bold text-green-700">Total Budget</div>
                    <div class="text-lg font-black text-green-800" id="total-budget">‚Ç±0</div>
                  </div>
                </div>
                <div class="text-right">
                  <div class="flex items-center gap-1 text-green-600 text-xs font-semibold">
                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/>
                    </svg>
                    <span>Active</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Enhanced Search and Filter Bar (Right Side) -->
        <div class="lg:w-2/3">
          <div class="bg-gradient-to-br from-white/95 to-blue-50/95 backdrop-blur-sm rounded-2xl shadow-lg p-6 border border-blue-100/50 relative overflow-hidden group hover:shadow-2xl transition-all duration-500">
            <!-- Decorative background elements -->
            <div class="absolute -top-8 -right-8 w-20 h-20 bg-gradient-to-br from-blue-400 to-blue-500 rounded-full opacity-10 blur-xl"></div>
            <div class="absolute -bottom-6 -left-6 w-16 h-16 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full opacity-15 blur-lg"></div>
            
            <!-- Header Section -->
            <div class="relative z-10 mb-4">
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-2">
                  <div class="w-8 h-8 bg-gradient-to-br from-blue-600 to-blue-700 rounded-xl flex items-center justify-center shadow-lg">
                    <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                    </svg>
                  </div>
                  <div>
                    <h3 class="text-lg font-black text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-blue-700">
                      Search & Filter
                    </h3>
                  </div>
                </div>
                <div class="flex items-center gap-1">
                  <div class="w-1.5 h-1.5 bg-blue-400 rounded-full animate-pulse"></div>
                  <div class="w-1.5 h-1.5 bg-blue-500 rounded-full animate-pulse" style="animation-delay: 0.2s"></div>
                  <div class="w-1.5 h-1.5 bg-blue-600 rounded-full animate-pulse" style="animation-delay: 0.4s"></div>
                </div>
              </div>
            </div>

            <div class="relative z-10 flex flex-col gap-4">
              <!-- Enhanced Search Input -->
              <div class="relative group">
                <div class="absolute inset-0 bg-gradient-to-r from-blue-400 to-blue-500 rounded-xl blur-lg opacity-0 group-hover:opacity-20 transition-opacity duration-300"></div>
                <div class="relative">
                  <input 
                    type="text" 
                    id="project-search" 
                    placeholder="Search for project name, code, or description..." 
                    class="w-full px-5 py-4 pl-12 bg-white/90 backdrop-blur-sm border-2 border-gray-200/50 rounded-xl focus:ring-4 focus:ring-blue-500/20 focus:border-blue-500 transition-all duration-300 text-base font-medium shadow-inner group-hover:shadow-lg group-hover:border-blue-300"
                  />
                  <div class="absolute left-4 top-1/2 transform -translate-y-1/2">
                    <div class="w-5 h-5 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center">
                      <svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                      </svg>
                    </div>
                  </div>
                  <!-- Search suggestions indicator -->
                  <div class="absolute right-3 top-1/2 transform -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                    <div class="flex items-center gap-1 text-xs text-gray-400 font-medium">
                      <kbd class="px-1.5 py-0.5 bg-gray-100 rounded border text-xs">‚åò</kbd>
                      <span>K</span>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- Enhanced Filter Row -->
              <div class="space-y-3">
                <div class="flex items-center gap-2 mb-2">
                  <div class="w-5 h-5 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center">
                    <svg class="w-2.5 h-2.5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.207A1 1 0 013 6.5V4z"/>
                    </svg>
                  </div>
                  <span class="text-sm font-bold text-gray-700">Advanced Filters</span>
                  <div class="flex-1 h-px bg-gradient-to-r from-gray-300 to-transparent"></div>
                </div>
                
                <div class="grid grid-cols-2 lg:grid-cols-4 gap-3">
                  <!-- Status Filter -->
                  <div class="group relative">
                    <label class="block text-xs font-bold text-gray-600 mb-1 flex items-center gap-1">
                      <div class="w-2.5 h-2.5 bg-green-500 rounded-full"></div>
                      Status
                    </label>
                    <select id="status-filter" class="w-full px-3 py-2.5 bg-white/90 border-2 border-gray-200/50 rounded-lg focus:ring-4 focus:ring-green-500/20 focus:border-green-500 transition-all duration-300 text-sm font-medium shadow-inner group-hover:shadow-lg group-hover:border-green-300">
                      <option value="">All Status</option>
                      <option value="ongoing">üü¢ Ongoing</option>
                      <option value="completed">üîµ Completed</option>
                      <option value="delayed">üî¥ Delayed</option>
                      <option value="pending">üü° Pending</option>
                    </select>
                  </div>
                  
                  <!-- Category Filter -->
                  <div class="group relative">
                    <label class="block text-xs font-bold text-gray-600 mb-1 flex items-center gap-1">
                      <div class="w-2.5 h-2.5 bg-blue-500 rounded-full"></div>
                      Category
                    </label>
                    <select id="category-filter" class="w-full px-3 py-2.5 bg-white/90 border-2 border-gray-200/50 rounded-lg focus:ring-4 focus:ring-blue-500/20 focus:border-blue-500 transition-all duration-300 text-sm font-medium shadow-inner group-hover:shadow-lg group-hover:border-blue-300">
                      <option value="">All Categories</option>
                      <option value="infrastructure">üèóÔ∏è Infrastructure</option>
                      <option value="health">üè• Health</option>
                      <option value="education">üéì Education</option>
                      <option value="social">ü§ù Social Services</option>
                      <option value="environment">üå± Environment</option>
                    </select>
                  </div>
                  
                  <!-- Priority Filter -->
                  <div class="group relative">
                    <label class="block text-xs font-bold text-gray-600 mb-1 flex items-center gap-1">
                      <div class="w-2.5 h-2.5 bg-orange-500 rounded-full"></div>
                      Priority
                    </label>
                    <select id="priority-filter" class="w-full px-3 py-2.5 bg-white/90 border-2 border-gray-200/50 rounded-lg focus:ring-4 focus:ring-orange-500/20 focus:border-orange-500 transition-all duration-300 text-sm font-medium shadow-inner group-hover:shadow-lg group-hover:border-orange-300">
                      <option value="">All Priorities</option>
                      <option value="high">üî¥ High</option>
                      <option value="medium">üü° Medium</option>
                      <option value="low">üü¢ Low</option>
                    </select>
                  </div>
                  
                  <!-- Barangay Filter -->
                  <div class="group relative">
                    <label class="block text-xs font-bold text-gray-600 mb-1 flex items-center gap-1">
                      <div class="w-2.5 h-2.5 bg-purple-500 rounded-full"></div>
                      Location
                    </label>
                    <select id="barangay-filter" class="w-full px-3 py-2.5 bg-white/90 border-2 border-gray-200/50 rounded-lg focus:ring-4 focus:ring-purple-500/20 focus:border-purple-500 transition-all duration-300 text-sm font-medium shadow-inner group-hover:shadow-lg group-hover:border-purple-300">
                      <option value="">All Barangays</option>
                      <option value="Alipit">üìç Alipit</option>
                      <option value="Bagumbayan">üìç Bagumbayan</option>
                      <option value="Bubukal">üìç Bubukal</option>
                      <option value="Calios">üìç Calios</option>
                      <option value="Duhat">üìç Duhat</option>
                      <option value="Gatid">üìç Gatid</option>
                      <option value="Jasaan">üìç Jasaan</option>
                      <option value="Labuin">üìç Labuin</option>
                      <option value="Malinao">üìç Malinao</option>
                      <option value="Oogong">üìç Oogong</option>
                      <option value="Palasan">üìç Palasan</option>
                      <option value="Patimbao">üìç Patimbao</option>
                      <option value="Poblacion I">üìç Poblacion I</option>
                      <option value="Poblacion II">üìç Poblacion II</option>
                      <option value="Poblacion III">üìç Poblacion III</option>
                      <option value="Poblacion IV">üìç Poblacion IV</option>
                      <option value="Poblacion V">üìç Poblacion V</option>
                      <option value="San Jose">üìç San Jose</option>
                      <option value="San Juan">üìç San Juan</option>
                      <option value="San Pablo Norte">üìç San Pablo Norte</option>
                      <option value="San Pablo Sur">üìç San Pablo Sur</option>
                      <option value="Santisima Cruz">üìç Santisima Cruz</option>
                      <option value="Santo Angel Central">üìç Santo Angel Central</option>
                      <option value="Santo Angel Norte">üìç Santo Angel Norte</option>
                      <option value="Santo Angel Sur">üìç Santo Angel Sur</option>
                    </select>
                  </div>
                </div>
              </div>
              
              <!-- Enhanced Action Buttons -->
              <div class="flex items-center justify-between pt-3 border-t border-gray-200/50">
                <div class="flex items-center gap-1 text-xs text-gray-500">
                  <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                  </svg>
                  <span>Use filters to narrow down results</span>
                </div>
                
                <div class="flex gap-2">
                  <!-- Clear Filters Button -->
                  <button 
                    id="clear-filters" 
                    class="group relative px-4 py-2 bg-gradient-to-r from-gray-100 to-gray-200 text-gray-700 rounded-lg hover:from-gray-200 hover:to-gray-300 transition-all duration-300 font-semibold text-sm shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95"
                  >
                    <div class="flex items-center gap-1.5">
                      <svg class="w-3.5 h-3.5 transition-transform duration-300 group-hover:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                      </svg>
                      Clear
                    </div>
                  </button>
                  
                  <!-- Search Button -->
                  <button 
                    id="advanced-search" 
                    class="group relative px-5 py-2 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-lg hover:from-blue-700 hover:to-blue-800 transition-all duration-300 font-bold text-sm shadow-lg hover:shadow-2xl transform hover:scale-105 active:scale-95"
                  >
                    <div class="absolute inset-0 bg-gradient-to-r from-blue-400 to-blue-500 rounded-lg blur-lg opacity-0 group-hover:opacity-30 transition-opacity duration-300"></div>
                    <div class="relative flex items-center gap-1.5">
                      <svg class="w-3.5 h-3.5 transition-transform duration-300 group-hover:scale-110" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                      </svg>
                      Search Projects
                      <svg class="w-3 h-3 opacity-0 group-hover:opacity-100 transition-all duration-300 transform translate-x-0 group-hover:translate-x-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                      </svg>
                    </div>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- View switcher -->
    <div class="w-full flex justify-center mt-2">
      <div class="w-full max-w-7xl">
        <slot name="view-switcher" />
      </div>
    </div>
    
    <!-- Deep link banner (shown when ?barangay= is present) -->
    <div class="w-full flex justify-center mt-3">
      <div id="deep-link-banner" class="hidden w-full max-w-7xl mx-auto">
        <div class="flex items-center justify-between p-4 rounded-xl border border-blue-200 bg-gradient-to-br from-blue-50 to-indigo-50 shadow-sm">
          <div class="flex items-center gap-3 text-blue-800">
            <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-blue-500 to-indigo-600 text-white flex items-center justify-center shadow">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 111.314 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
            </div>
            <div class="text-sm font-semibold">
              Filtering projects for <span id="deep-link-bgy" class="font-black"></span>
            </div>
          </div>
          <div class="flex items-center gap-2">
            <a id="deep-link-back" class="px-3 py-2 rounded-lg bg-white border border-blue-200 text-blue-700 font-semibold hover:bg-blue-50 shadow-sm" href="#">Back to Barangay</a>
            <button id="deep-link-clear" class="px-3 py-2 rounded-lg bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-bold shadow hover:shadow-md">Clear</button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Main content area -->
    <div class="w-full max-w-7xl mx-auto mt-8">
      <ProjectsIsland client:only="react" />
    </div>
  </main>
  <LGUFooter />
</Layout>

<script>
  // Highlight animation style
  const style = document.createElement('style');
  style.innerHTML = `
    .deep-link-highlight { position: relative; box-shadow: 0 0 0 3px rgba(59,130,246,0.35) inset, 0 10px 20px rgba(59,130,246,0.15); transition: box-shadow .3s ease; }
  `;
  document.head.appendChild(style);

  // Enhanced search and filter functionality
  document.addEventListener('DOMContentLoaded', function() {
    initializeSearchAndFilters();
    initializeKeyboardShortcuts();
    initializeAnalytics();
    applyDeepLinkFromURL();
    
    // Also initialize analytics after a short delay to ensure DOM is ready
    setTimeout(() => {
      console.log('Checking if analytics elements exist...');
      const totalProjectsEl = document.getElementById('total-projects');
      const ongoingProjectsEl = document.getElementById('ongoing-projects');
      const completedProjectsEl = document.getElementById('completed-projects');
      const avgProgressEl = document.getElementById('avg-progress');
      const totalBudgetEl = document.getElementById('total-budget');
      
      console.log('Analytics elements found:', {
        totalProjectsEl: !!totalProjectsEl,
        ongoingProjectsEl: !!ongoingProjectsEl,
        completedProjectsEl: !!completedProjectsEl,
        avgProgressEl: !!avgProgressEl,
        totalBudgetEl: !!totalBudgetEl
      });
      
      // Try to fetch projects directly if analytics are still empty
      if (totalProjectsEl && totalProjectsEl.textContent === '-') {
        console.log('Analytics are empty, attempting to fetch projects directly...');
        // Get API URL dynamically based on environment (using same logic as config/api.js)
        const getApiUrl = () => {
          const hostname = window.location.hostname;
          const protocol = window.location.protocol;
          if (hostname === 'localhost' || hostname === '127.0.0.1') {
            return 'http://localhost:3000/api';
          }
          if (hostname.includes('build-watch.com')) {
            // For HTTPS, use same domain without port (Nginx reverse proxy expected)
            if (protocol === 'https:') {
              return protocol + '//' + hostname + '/api';
            } else {
              return 'http://' + hostname + ':3000/api';
            }
          }
          return 'http://localhost:3000/api';
        };
        const apiUrl = getApiUrl();
        console.log('Using API URL:', apiUrl);
        fetch(`${apiUrl}/projects/public?page=1&limit=10`)
          .then(response => response.json())
          .then(data => {
            if (data.success && data.projects) {
              console.log('Fetched projects directly:', data.projects);
              const mappedProjects = data.projects.map(project => ({
                id: project.id,
                name: project.name,
                code: project.projectCode,
                location: project.location,
                implementingUnitName: project.implementingOfficeName,
                budget: project.totalBudget,
                status: project.status,
                progress: project.progress?.overall || project.progress?.overallProgress || project.overallProgress || 0,
                startDate: project.startDate,
                endDate: project.endDate,
                category: project.category,
                priority: project.priority,
                fundingSource: project.fundingSource,
                description: project.description,
                hasExternalPartner: project.hasExternalPartner,
                eiuPersonnelName: project.eiuPersonnelName,
                createdAt: project.createdAt,
                updatedAt: project.updatedAt
              }));
              updateAnalyticsDisplay(mappedProjects);
            }
          })
          .catch(error => {
            console.error('Error fetching projects directly:', error);
          });
      }
    }, 1000);
  });

  function initializeSearchAndFilters() {
    const searchInput = document.getElementById('project-search');
    const statusFilter = document.getElementById('status-filter');
    const categoryFilter = document.getElementById('category-filter');
    const priorityFilter = document.getElementById('priority-filter');
    const barangayFilter = document.getElementById('barangay-filter');
    const clearFiltersBtn = document.getElementById('clear-filters');
    const advancedSearchBtn = document.getElementById('advanced-search');

    // Add event listeners
    if (searchInput) {
      searchInput.addEventListener('input', handleSearch);
      searchInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          handleAdvancedSearch();
        }
      });
    }
    if (statusFilter) {
      statusFilter.addEventListener('change', handleFilter);
    }
    if (categoryFilter) {
      categoryFilter.addEventListener('change', handleFilter);
    }
    if (priorityFilter) {
      priorityFilter.addEventListener('change', handleFilter);
    }
    if (barangayFilter) {
      barangayFilter.addEventListener('change', handleFilter);
    }
    if (clearFiltersBtn) {
      clearFiltersBtn.addEventListener('click', clearAllFilters);
    }
    if (advancedSearchBtn) {
      advancedSearchBtn.addEventListener('click', handleAdvancedSearch);
    }

    // Add focus effects
    addFocusEffects();
  }

  // Read ?barangay= query and pre-apply filter
  function applyDeepLinkFromURL() {
    try {
      const params = new URLSearchParams(window.location.search);
      const bgy = params.get('barangay');
      if (!bgy) return;
      const barangayFilter = document.getElementById('barangay-filter');
      if (barangayFilter) {
        // Try exact match; if not found leave value and still dispatch
        const options = Array.from(barangayFilter.options).map(o => o.value);
        if (options.includes(bgy)) {
          barangayFilter.value = bgy;
        }
        // Dispatch a filter event so ProjectsIsland can refresh
        handleFilter();
        // Re-dispatch after island mounts (React may not be ready yet)
        setTimeout(handleFilter, 600);
        setTimeout(handleFilter, 1300);
        // Show banner
        const banner = document.getElementById('deep-link-banner');
        const label = document.getElementById('deep-link-bgy');
        const back = document.getElementById('deep-link-back');
        if (banner && label && back) {
          label.textContent = bgy;
          back.href = `/barangay/${encodeURIComponent(bgy)}`;
          banner.classList.remove('hidden');
        }
        // Scroll to results area
        const container = document.querySelector('.w-full.max-w-7xl.mx-auto.mt-8');
        if (container) container.scrollIntoView({ behavior: 'smooth', block: 'start' });
        // Add a little highlight
        barangayFilter.classList.add('ring-2','ring-blue-500');
        setTimeout(()=> barangayFilter.classList.remove('ring-2','ring-blue-500'), 1200);

        // Clear deep link
        const clearBtn = document.getElementById('deep-link-clear');
        if (clearBtn) {
          clearBtn.onclick = () => {
            const banner = document.getElementById('deep-link-banner');
            if (barangayFilter) barangayFilter.value = '';
            handleFilter();
            if (banner) banner.classList.add('hidden');
            const url = new URL(window.location.href);
            url.searchParams.delete('barangay');
            window.history.replaceState({}, '', url);
          };
        }

        // Highlight rows matching barangay
        const tryHighlight = () => highlightBarangayRows(bgy);
        setTimeout(tryHighlight, 700);
        setTimeout(tryHighlight, 1500);
      }
    } catch (e) {
      console.warn('Failed to apply deep link filter', e);
    }
  }

  // Briefly highlight rows that match the barangay
  function highlightBarangayRows(barangayName) {
    const container = document.querySelector('.w-full.max-w-7xl.mx-auto.mt-8');
    if (!container) return;
    const text = (v) => (v || '').trim().toLowerCase();
    const targets = Array.from(container.querySelectorAll('td, div, span, p'))
      .filter(el => el.childElementCount === 0 && text(el.textContent) === text(barangayName));
    if (targets.length === 0) return;
    targets.forEach(el => {
      const row = el.closest('tr') || el.closest('.project-row') || el.closest('.group') || el.closest('.bg-white');
      if (row && !row.classList.contains('deep-link-highlight')) {
        row.classList.add('deep-link-highlight');
        setTimeout(() => row.classList.remove('deep-link-highlight'), 2000);
      }
    });
  }

  function initializeKeyboardShortcuts() {
    document.addEventListener('keydown', function(e) {
      // Cmd/Ctrl + K to focus search
      if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
        e.preventDefault();
        const searchInput = document.getElementById('project-search');
        if (searchInput) {
          searchInput.focus();
        }
      }
      
      // Escape to clear filters
      if (e.key === 'Escape') {
        clearAllFilters();
      }
    });
  }

  function addFocusEffects() {
    const inputs = document.querySelectorAll('input, select');
    inputs.forEach(input => {
      input.addEventListener('focus', function() {
        this.parentElement.classList.add('ring-4', 'ring-blue-600/20');
      });
      
      input.addEventListener('blur', function() {
        this.parentElement.classList.remove('ring-4', 'ring-blue-600/20');
      });
    });
  }

  function handleSearch() {
    const searchTerm = document.getElementById('project-search').value.toLowerCase();
    console.log('Astro: Dispatching projectSearch event with searchTerm:', searchTerm);
    // This will be handled by the ProjectsIsland component
    window.dispatchEvent(new CustomEvent('projectSearch', { 
      detail: { searchTerm } 
    }));
  }

  function handleFilter() {
    const status = document.getElementById('status-filter').value;
    const category = document.getElementById('category-filter').value;
    const priority = document.getElementById('priority-filter').value;
    const barangay = document.getElementById('barangay-filter').value;
    
    console.log('Astro: Dispatching projectFilter event with:', { status, category, priority, barangay });
    // This will be handled by the ProjectsIsland component
    window.dispatchEvent(new CustomEvent('projectFilter', { 
      detail: { status, category, priority, barangay } 
    }));
  }

  function handleAdvancedSearch() {
    const searchTerm = document.getElementById('project-search').value;
    const status = document.getElementById('status-filter').value;
    const category = document.getElementById('category-filter').value;
    const priority = document.getElementById('priority-filter').value;
    const barangay = document.getElementById('barangay-filter').value;
    
    console.log('Astro: Dispatching projectAdvancedSearch event with:', { searchTerm, status, category, priority, barangay });
    
    // Show loading state
    const searchBtn = document.getElementById('advanced-search');
    if (searchBtn) {
      const originalText = searchBtn.innerHTML;
      searchBtn.innerHTML = `
        <svg class="animate-spin w-5 h-5" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        Searching...
      `;
      
      setTimeout(() => {
        searchBtn.innerHTML = originalText;
      }, 1000);
    }
    
    // This will be handled by the ProjectsIsland component
    window.dispatchEvent(new CustomEvent('projectAdvancedSearch', { 
      detail: { searchTerm, status, category, priority, barangay } 
    }));
  }

  function clearAllFilters() {
    const searchInput = document.getElementById('project-search');
    const statusFilter = document.getElementById('status-filter');
    const categoryFilter = document.getElementById('category-filter');
    const priorityFilter = document.getElementById('priority-filter');
    const barangayFilter = document.getElementById('barangay-filter');
    
    if (searchInput) searchInput.value = '';
    if (statusFilter) statusFilter.value = '';
    if (categoryFilter) categoryFilter.value = '';
    if (priorityFilter) priorityFilter.value = '';
    if (barangayFilter) barangayFilter.value = '';
    
    console.log('Astro: Dispatching projectFilterReset event');
    
    // Add visual feedback
    const clearBtn = document.getElementById('clear-filters');
    if (clearBtn) {
      clearBtn.classList.add('bg-green-100', 'text-green-700');
      setTimeout(() => {
        clearBtn.classList.remove('bg-green-100', 'text-green-700');
      }, 500);
    }
    
    // Trigger filter reset
    window.dispatchEvent(new CustomEvent('projectFilterReset'));
  }

  // Add smooth animations for better UX
  function addSmoothAnimations() {
    const searchBar = document.querySelector('.search-filter-bar');
    if (searchBar) {
      searchBar.style.opacity = '0';
      searchBar.style.transform = 'translateY(20px)';
      
      setTimeout(() => {
        searchBar.style.transition = 'all 0.6s ease-out';
        searchBar.style.opacity = '1';
        searchBar.style.transform = 'translateY(0)';
      }, 100);
    }
  }

  // Initialize animations when page loads
  window.addEventListener('load', addSmoothAnimations);

  // Analytics functionality
  function updateAnalyticsDisplay(projects) {
    console.log('Updating analytics with projects:', projects);
    
    const totalProjects = projects.length;
    const ongoingProjects = projects.filter(p => p.status?.toLowerCase() === 'ongoing').length;
    const completedProjects = projects.filter(p => p.status?.toLowerCase() === 'completed').length;
    const delayedProjects = projects.filter(p => p.status?.toLowerCase() === 'delayed').length;
    
    // Calculate unique departments
    const uniqueDepartments = new Set(projects.map(p => p.implementingUnitName || p.implementingOfficeName).filter(Boolean));
    const totalDepartments = uniqueDepartments.size;
    
    // Calculate average progress
    const validProjects = projects.filter(p => !isNaN(Number(p.progress)) && p.progress !== undefined && p.progress !== null);
    const averageProgress = validProjects.length > 0 
      ? Math.round(validProjects.reduce((sum, p) => sum + Number(p.progress || 0), 0) / validProjects.length)
      : 0;
    
    // Calculate total budget
    const totalBudget = projects.reduce((total, project) => {
      const budget = Number(project.budget || project.totalBudget);
      return total + (isNaN(budget) ? 0 : budget);
    }, 0);
    
    console.log('Analytics calculations:', {
      totalProjects,
      totalDepartments,
      ongoingProjects,
      delayedProjects,
      completedProjects,
      averageProgress,
      totalBudget
    });
    
    // Update DOM elements
    const totalProjectsEl = document.getElementById('total-projects');
    const totalDepartmentsEl = document.getElementById('total-departments');
    const ongoingProjectsEl = document.getElementById('ongoing-projects');
    const delayedProjectsEl = document.getElementById('delayed-projects');
    const completedProjectsEl = document.getElementById('completed-projects');
    const avgProgressEl = document.getElementById('avg-progress');
    const totalBudgetEl = document.getElementById('total-budget');
    
    if (totalProjectsEl) {
      totalProjectsEl.textContent = totalProjects;
      console.log('Updated total projects:', totalProjects);
    }
    if (totalDepartmentsEl) {
      totalDepartmentsEl.textContent = totalDepartments;
      console.log('Updated total departments:', totalDepartments);
    }
    if (ongoingProjectsEl) {
      ongoingProjectsEl.textContent = ongoingProjects;
      console.log('Updated ongoing projects:', ongoingProjects);
    }
    if (delayedProjectsEl) {
      delayedProjectsEl.textContent = delayedProjects;
      console.log('Updated delayed projects:', delayedProjects);
    }
    if (completedProjectsEl) {
      completedProjectsEl.textContent = completedProjects;
      console.log('Updated completed projects:', completedProjects);
    }
    if (avgProgressEl) {
      avgProgressEl.textContent = averageProgress + '%';
      console.log('Updated average progress:', averageProgress);
    }
    if (totalBudgetEl) {
      const formattedBudget = new Intl.NumberFormat('en-PH', {
        style: 'currency',
        currency: 'PHP',
        minimumFractionDigits: 0,
        maximumFractionDigits: 0
      }).format(totalBudget);
      totalBudgetEl.textContent = formattedBudget;
      console.log('Updated total budget:', formattedBudget);
    }
  }

  function initializeAnalytics() {
    console.log('Initializing analytics event listeners...');
    
    // Listen for project data updates from ProjectsIsland
    document.addEventListener('projectsUpdated', function(event) {
      console.log('Received projectsUpdated event:', event.detail);
      updateAnalyticsDisplay(event.detail.projects);
    });
    
    // Also listen for the existing projectSearch event to update analytics
    document.addEventListener('projectSearch', function(event) {
      console.log('Received projectSearch event:', event.detail);
      // Analytics will be updated when projects are fetched
    });
    
    // Listen for initial load
    document.addEventListener('projectsLoaded', function(event) {
      console.log('Received projectsLoaded event:', event.detail);
      updateAnalyticsDisplay(event.detail.projects);
    });
    
    console.log('Analytics event listeners initialized');
  }
</script>

<style>
  .fade-in-projects {
    animation: fadeInProjects 1.1s cubic-bezier(.4,0,.2,1);
  }
  
  @keyframes fadeInProjects {
    from { 
      opacity: 0; 
      transform: translateY(40px); 
    }
    to { 
      opacity: 1; 
      transform: none; 
    }
  }
</style> 